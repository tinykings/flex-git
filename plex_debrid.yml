tasks:

  edits:
    metainfo_series: yes
    trakt_lookup: yes
    tvmaze_lookup: yes
    filesystem:
      path: "/home/pi/real_debrid/shows/"
      recursive: yes
      retrieve: files
      regexp: '.*\.(avi|mkv|mp4)$'
    if:
      - trakt_series_content_rating == 'TV-MA': accept
      - "'anime' in trakt_genres": reject
    exec:
      on_output:
        for_accepted:
          - cp "{{location}}" "/home/pi/edits/{{filename}}"
          - cleanvid -i "/home/pi/edits/{{filename}}" -o "/home/pi/edits/{{filename}}_clean.mkv" -w /home/pi/flexget/swears.txt -e
          - if [ -f "/home/pi/edits/{{filename}}_clean.mkv" ]; then rm "/home/pi/edits/{{filename}}"; else echo "nothing to clean"; fi
          - rm "{{location}}"
      on_exit:
        phase: rm /home/pi/edits/*.srt
        
  newmovies:
    imdb_lookup: yes
    trakt_list:
      username: giladg
      list: latest-releases
      type: movies
      strip_dates: yes
    imdb:
      min_score: 7
      min_votes: 5000
      reject_genres:
        - horror
      accept_mpaa_ratings:
        - G
        - PG
        - PG-13
    list_add:
      - trakt_list:
          username: profile
          account: profile
          list: watchlist
          type: movies
          
  watched:
    metainfo_series: yes
    trakt_lookup:
      username: profile
      account: profile
    filesystem:
      path:
        - "/home/pi/real_debrid/shows/"
        - "/home/pi/edits/"
      recursive: yes
      retrieve: files
      regexp: '.*\.(avi|mkv|mp4)$'
    if:
      - trakt_watched: accept
    exec:
      on_output:
        for_accepted:
          - rm "{{location}}"


